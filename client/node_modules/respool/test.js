
var _ 			= require('underscore');
var respool 	= require('./respool');

var childClass	= function(callback) {
	this.count	= 0;
	setTimeout(function() {
		callback();
	}, _.random(200,1000));
};
childClass.prototype.hit = function () {
	this.count++;
	return this.count;
};



var demo	= function(n) {
	var scope	= this;
	this.n		= n;
	this.spool	= new respool({
		async:		false,
		progress:	'Creating...',
		count:		10,
		min:		2,
		create:		function(done) {
			var instance;
			instance = new childClass(function() {
				done(instance);
			});
		}
	});
	this.spool.init(function() {
		console.log("Spool.init()");
		scope.start();
		scope.output();
	});
	
}
demo.prototype.start = function() {
	var i;
	console.log("Start", this.n);
	for (i=0;i<this.n;i++) {
		this.spool.instance().hit();
	}
}
demo.prototype.output = function() {
	_.each(this.spool.counts, function(count, n) {
		console.log("Instance #"+n, count);
	});
}


var test	= new demo(100);

/*
var colors = function() {
	var start	= 29;
	var end		= 70;
	var i		= 0;
	for (i=start;i<end;i++) {
		console.log("\033["+i+"mHello\033[37m", i);
	}
	var formats	= {
		reset:	37,
		color:	{
			red:	31,
			green:	32,
			yellow:	33,
			blue:	34,
			magenta:35,
			cyan:	36,
			white:	37
		},
		bg:	{
			red:	41,
			green:	42,
			yellow:	43,
			blue:	44,
			magenta:45,
			cyan:	46,
			white:	47
		}
	}
}
colors();
*/